<!DOCTYPE html>
<html lang="id" class="dark"> <!-- Default to dark mode -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Schedule Kelas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
          darkMode: 'class',
        }
    </script>
    <style>
        /* Light Mode Styles */
        .light body { background-image: none; background-color: #f1f5f9; color: #1e293b; }
        .light .glass-card { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid #e2e8f0; }
        .light .text-slate-100 { color: #1e293b; } .light .text-slate-200 { color: #334155; }
        .light .text-slate-300 { color: #475569; } .light .text-slate-400 { color: #64748b; }
        .light .border-slate-700 { border-color: #e2e8f0; }
        .light .input-dark { background-color: #f8fafc; border-color: #cbd5e1; color: #1e293b; }
        .light .input-dark:focus { border-color: #38bdf8; }
        .light .tab-btn.active { background-color: #e0f2fe; }
        .light #notification-badge { border-color: #f1f5f9; }
        .light .hover\:bg-slate-800\/50:hover { background-color: #f1f5f9; }
        /* Text Size Classes */
        .text-sm-app { font-size: 14px; } .text-md-app { font-size: 16px; } .text-lg-app { font-size: 18px; }

        body { font-family: 'Inter', sans-serif; padding-top: 0; transition: padding-top 0.5s ease; background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop'); background-size: cover; background-position: center; background-attachment: fixed; }
        .hidden { display: none; }
        .modal-backdrop { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { transform: scale(0.9); opacity: 0; transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
        .modal-backdrop.flex { display: flex; } .modal-backdrop.flex .modal-content { transform: scale(1); opacity: 1; }
        .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); transition: bottom 0.5s ease-in-out; z-index: 1100; }
        .toast.show { bottom: 20px; }
        #notification-banner { transition: transform 0.5s ease-in-out; }
        .tab-btn.active { border-color: #38bdf8; color: #38bdf8; background-color: rgba(14, 116, 144, 0.2); }
        .glass-card { background-color: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-dark { background-color: rgba(15, 23, 42, 0.8); border-color: #475569; }
        .input-dark:focus { border-color: #38bdf8; --tw-ring-color: #38bdf8; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200">

    <div id="notification-banner" class="hidden fixed top-0 left-0 right-0 bg-green-500 text-white p-4 text-center z-[2000] shadow-lg transform -translate-y-full">
        <span id="notification-message" class="font-semibold"></span>
        <button id="close-notification-btn" class="absolute top-1/2 right-4 -translate-y-1/2 font-bold text-2xl leading-none">&times;</button>
    </div>

    <div id="login-page" class="flex items-center justify-center min-h-screen p-4">
        <div class="w-full max-w-sm p-8 space-y-6 rounded-2xl shadow-lg glass-card relative">
            <div id="login-view">
                <div>
                    <h1 class="text-3xl font-bold text-center text-slate-100">E-Schedule Login</h1>
                    <p class="text-center text-slate-400 mt-2">Selamat datang, Kapten!</p>
                </div>
                <form id="login-form" class="space-y-4 pt-6">
                    <div>
                        <label for="class-select" class="text-sm font-medium text-slate-300">Pilih Kelas</label>
                        <select id="class-select" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark">
                            <option value="" disabled selected>-- Pilih Kelas Anda --</option>
                        </select>
                    </div>
                    <div>
                        <label for="login-username" class="text-sm font-medium text-slate-300">Username</label>
                        <input id="login-username" type="text" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark" placeholder="Username Anda">
                    </div>
                    <div>
                        <label for="password" class="text-sm font-medium text-slate-300">Password</label>
                        <input id="password" type="password" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark" placeholder="••••••••">
                    </div>
                    <p id="login-error" class="text-sm text-red-400 hidden"></p>
                    <button type="submit" class="w-full py-3 font-semibold text-white bg-sky-600 rounded-lg hover:bg-sky-700">Login</button>
                </form>
                <p class="text-xs text-center text-slate-400 pt-4">Belum punya akun? <a href="#" id="show-register-link" class="font-medium text-sky-400 hover:underline">Daftar disini</a></p>
            </div>
             <div id="register-step" class="hidden">
                 <button id="back-to-login-btn" class="absolute top-4 left-4 text-slate-400 hover:text-slate-200 transition">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                  </button>
                <div>
                    <h1 class="text-3xl font-bold text-center text-slate-100">Daftar Akun Baru</h1>
                </div>
                <form id="register-form" class="space-y-4 pt-6">
                    <div>
                        <label for="register-username" class="text-sm font-medium text-slate-300">Username</label>
                        <input id="register-username" type="text" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark">
                    </div>
                    <div>
                        <label for="register-email" class="text-sm font-medium text-slate-300">Email</label>
                        <input id="register-email" type="email" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark">
                    </div>
                    <div>
                        <label for="register-password" class="text-sm font-medium text-slate-300">Password</label>
                        <input id="register-password" type="password" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark">
                    </div>
                     <div>
                        <label for="register-role" class="text-sm font-medium text-slate-300">Daftar sebagai</label>
                        <select id="register-role" required class="w-full px-3 py-2 mt-1 rounded-lg focus:ring-2 transition input-dark">
                            <option value="siswa">Siswa</option><option value="guru">Guru</option>
                        </select>
                    </div>
                    <p id="register-error" class="text-sm text-red-400 hidden"></p>
                    <button type="submit" class="w-full py-3 font-semibold text-white bg-sky-600 rounded-lg hover:bg-sky-700">Daftar</button>
                </form>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="container mx-auto max-w-5xl p-4 sm:p-6">
            <header class="text-center mb-6">
                 <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                    <div id="welcome-message" class="text-left text-sm text-slate-400"></div>
                    <div class="flex items-center gap-4">
                        <div id="notification-icon-container" class="relative cursor-pointer">
                            <svg class="h-6 w-6 text-slate-300 hover:text-sky-400 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
                            <span id="notification-badge" class="absolute top-0 right-0 h-2.5 w-2.5 bg-red-500 rounded-full border-2 border-slate-900 hidden"></span>
                        </div>
                        <div id="clock" class="text-sm font-semibold text-slate-300 glass-card px-3 py-1 rounded-lg"></div>
                        <button id="logout-btn" class="text-sm font-medium bg-slate-700 text-slate-200 px-4 py-2 rounded-lg hover:bg-slate-600 transition">Logout</button>
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-slate-100 tracking-wider">E-Schedule Kelas</h1>
                <p id="class-display" class="text-sky-400 font-semibold mt-2"></p>
            </header>

            <div class="mb-6 flex flex-wrap justify-center border-b border-slate-700">
                 <button id="tab-schedule" class="tab-btn active text-slate-300 py-3 px-6 font-semibold border-b-2 border-transparent transition hover:bg-slate-800/50">Jadwal</button>
                 <button id="tab-tasks" class="tab-btn text-slate-300 py-3 px-6 font-semibold border-b-2 border-transparent transition hover:bg-slate-800/50">Tugas</button>
                 <button id="tab-piket" class="tab-btn text-slate-300 py-3 px-6 font-semibold border-b-2 border-transparent transition hover:bg-slate-800/50">Piket</button>
                 <button id="tab-dates" class="tab-btn text-slate-300 py-3 px-6 font-semibold border-b-2 border-transparent transition hover:bg-slate-800/50">Kalender</button>
                 <button id="tab-users" class="tab-btn text-slate-300 py-3 px-6 font-semibold border-b-2 border-transparent transition hover:bg-slate-800/50 hidden">Users</button>
                 <button id="tab-settings" class="tab-btn text-slate-300 py-3 px-6 font-semibold border-b-2 border-transparent transition hover:bg-slate-800/50">Pengaturan</button>
            </div>

            <div id="admin-controls" class="flex justify-center gap-4 mb-8 hidden">
                <button id="add-schedule-btn" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105 flex items-center gap-2"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>Tambah Jadwal</button>
                <button id="add-task-btn" class="bg-amber-500 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-amber-600 transition-transform transform hover:scale-105 hidden items-center gap-2"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V8z" clip-rule="evenodd" /></svg>Tambah Tugas</button>
                <button id="edit-piket-btn" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-transform transform hover:scale-105 hidden items-center gap-2"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zm-1.5 5.5a3 3 0 00-3 0V12a2 2 0 00-2 2v1a2 2 0 002 2h3.5a2 2 0 002-2v-1a2 2 0 00-2-2v-.5zM16 6a3 3 0 11-6 0 3 3 0 016 0zm-1.5 5.5a3 3 0 00-3 0V12a2 2 0 00-2 2v1a2 2 0 002 2H16a2 2 0 002-2v-1a2 2 0 00-2-2v-.5z" /></svg>Ubah Piket</button>
                <button id="add-date-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-transform transform hover:scale-105 hidden items-center gap-2"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zM4.75 8.5a.75.75 0 000 1.5h10.5a.75.75 0 000-1.5H4.75z" clip-rule="evenodd" /></svg>Tambah Tanggal</button>
                <button id="add-user-btn" class="bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-purple-700 transition-transform transform hover:scale-105 hidden items-center gap-2"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>Tambah User</button>
            </div>

            <main id="schedule-container" class="space-y-8"></main>
            <main id="tasks-container" class="hidden"></main>
            <main id="piket-container" class="hidden"></main>
            <main id="dates-container" class="hidden"></main>
            <main id="users-container" class="hidden"></main>
            <main id="settings-container" class="hidden"></main>
        </div>
    </div>

    <!-- Modals -->
    <div id="schedule-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 id="schedule-modal-title" class="text-2xl font-bold mb-6 text-slate-100"></h2> <form id="schedule-form"> <input type="hidden" id="schedule-id"> <div class="space-y-4 text-slate-300"> <div><label for="day" class="block text-sm font-medium mb-1">Hari</label><select id="day" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"><option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option><option>Jumat</option><option>Sabtu</option></select></div> <div><label for="subject" class="block text-sm font-medium mb-1">Mata Pelajaran</label><input type="text" id="subject" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Matematika"></div> <div class="grid grid-cols-2 gap-4"> <div><label for="start-time" class="block text-sm font-medium mb-1">Waktu Mulai</label><input type="time" id="start-time" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> <div><label for="end-time" class="block text-sm font-medium mb-1">Waktu Selesai</label><input type="time" id="end-time" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> </div> <div><label for="teacher" class="block text-sm font-medium mb-1">Guru</label><input type="text" id="teacher" class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Bpk. Andi"></div> <div><label for="room" class="block text-sm font-medium mb-1">Ruangan</label><input type="text" id="room" class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Lab Komputer"></div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-schedule-btn" class="px-4 py-2 bg-slate-600 text-slate-200 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Simpan</button> </div> </form> </div> </div>
    <div id="task-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 id="task-modal-title" class="text-2xl font-bold mb-6 text-slate-100"></h2> <form id="task-form"> <input type="hidden" id="task-id"> <div class="space-y-4 text-slate-300"> <div><label for="task-subject" class="block text-sm font-medium mb-1">Mata Pelajaran</label><input type="text" id="task-subject" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Fisika"></div> <div><label for="task-title" class="block text-sm font-medium mb-1">Judul Tugas</label><input type="text" id="task-title" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Laporan Praktikum"></div> <div><label for="task-due-date" class="block text-sm font-medium mb-1">Tenggat Waktu</label><input type="date" id="task-due-date" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> <div><label for="task-description" class="block text-sm font-medium mb-1">Deskripsi</label><textarea id="task-description" rows="3" class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Detail tugas..."></textarea></div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-task-btn" class="px-4 py-2 bg-slate-600 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600">Simpan</button> </div> </form> </div> </div>
    <div id="piket-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 id="piket-modal-title" class="text-2xl font-bold mb-6 text-slate-100">Ubah Jadwal Piket</h2> <form id="piket-form"> <input type="hidden" id="piket-day"> <div class="space-y-4 text-slate-300"> <div><label for="piket-day-display" class="block text-sm font-medium mb-1">Hari</label><input type="text" id="piket-day-display" readonly class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg"></div> <div><label for="piket-students" class="block text-sm font-medium mb-1">Nama Siswa (pisahkan dengan koma)</label><textarea id="piket-students" rows="5" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Budi, Ani, Candra, Dewi"></textarea></div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-piket-btn" class="px-4 py-2 bg-slate-600 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Simpan</button> </div> </form> </div> </div>
    <div id="user-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 id="user-modal-title" class="text-2xl font-bold mb-6 text-slate-100"></h2> <form id="user-form"> <input type="hidden" id="user-id"> <div class="space-y-4 text-slate-300"> <div><label for="user-username" class="block text-sm font-medium mb-1">Username</label><input type="text" id="user-username" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> <div><label for="user-password" class="block text-sm font-medium mb-1">Password</label><input type="password" id="user-password" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> <div><label for="user-role" class="block text-sm font-medium mb-1">Peran</label><select id="user-role" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"><option value="siswa">Siswa</option><option value="guru">Guru</option><option value="admin">Admin</option></select></div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-user-btn" class="px-4 py-2 bg-slate-600 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Simpan</button> </div> </form> </div> </div>
    <div id="date-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 id="date-modal-title" class="text-2xl font-bold mb-6 text-slate-100"></h2> <form id="date-form"> <input type="hidden" id="date-id"> <div class="space-y-4 text-slate-300"> <div><label for="date-title" class="block text-sm font-medium mb-1">Nama Acara</label><input type="text" id="date-title" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Ujian Akhir Semester"></div> <div><label for="date-date" class="block text-sm font-medium mb-1">Tanggal</label><input type="date" id="date-date" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> <div><label for="date-type" class="block text-sm font-medium mb-1">Jenis</label><select id="date-type" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"><option value="ujian">Ujian</option><option value="libur">Libur</option><option value="acara">Acara Sekolah</option></select></div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-date-btn" class="px-4 py-2 bg-slate-600 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Simpan</button> </div> </form> </div> </div>
    <div id="notes-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 id="notes-modal-title" class="text-2xl font-bold mb-6 text-slate-100"></h2> <form id="notes-form"> <input type="hidden" id="notes-schedule-id"> <div class="space-y-4 text-slate-300"> <div> <label for="notes-content" class="block text-sm font-medium mb-1">Tulis catatan Anda di sini:</label> <textarea id="notes-content" rows="8" class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark" placeholder="Contoh: Jangan lupa bawa buku paket halaman 50..."></textarea> </div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-notes-btn" class="px-4 py-2 bg-slate-600 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">Simpan Catatan</button> </div> </form> </div> </div>
    <div id="password-modal" class="modal-backdrop"> <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-2xl m-4 glass-card"> <h2 class="text-2xl font-bold mb-6 text-slate-100">Ganti Password</h2> <form id="password-form"> <div class="space-y-4 text-slate-300"> <div><label for="current-password" class="block text-sm font-medium mb-1">Password Saat Ini</label><input type="password" id="current-password" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> <div><label for="new-password" class="block text-sm font-medium mb-1">Password Baru</label><input type="password" id="new-password" required class="w-full px-3 py-2 rounded-lg focus:ring-2 transition input-dark"></div> </div> <div class="flex justify-end gap-3 mt-8"> <button type="button" id="cancel-password-btn" class="px-4 py-2 bg-slate-600 rounded-lg hover:bg-slate-500">Batal</button> <button type="submit" class="px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700">Simpan</button> </div> </form> </div> </div>
    
    <div id="toast" class="toast bg-slate-100 text-slate-900 py-2 px-5 rounded-full shadow-lg">
        <p id="toast-message" class="font-semibold"></p>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- SUPABASE SETUP ---
    const SUPABASE_URL = "https://mbcytjxzrtetvpwuqouz.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1iY3l0anh6cnRldHZwd3Vxb3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0NjAxMDksImV4cCI6MjA3NjAzNjEwOX0.AmzJT0uop8DLIVXxMoqESZgd3619LC062WWyX-UkdfU";
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- DOM Elements ---
    const allElements = {
        classSelect: document.getElementById('class-select'), classDisplay: document.getElementById('class-display'),
        loginPage: document.getElementById('login-page'), loginView: document.getElementById('login-view'),
        loginForm: document.getElementById('login-form'), loginError: document.getElementById('login-error'),
        mainApp: document.getElementById('main-app'),
        logoutBtn: document.getElementById('logout-btn'), welcomeMessage: document.getElementById('welcome-message'),
        adminControls: document.getElementById('admin-controls'), addScheduleBtn: document.getElementById('add-schedule-btn'), addTaskBtn: document.getElementById('add-task-btn'), editPiketBtn: document.getElementById('edit-piket-btn'), addUserBtn: document.getElementById('add-user-btn'), addDateBtn: document.getElementById('add-date-btn'),
        scheduleModal: document.getElementById('schedule-modal'), scheduleModalTitle: document.getElementById('schedule-modal-title'), scheduleForm: document.getElementById('schedule-form'), cancelScheduleBtn: document.getElementById('cancel-schedule-btn'),
        taskModal: document.getElementById('task-modal'), taskModalTitle: document.getElementById('task-modal-title'), taskForm: document.getElementById('task-form'), cancelTaskBtn: document.getElementById('cancel-task-btn'),
        piketModal: document.getElementById('piket-modal'), piketForm: document.getElementById('piket-form'), cancelPiketBtn: document.getElementById('cancel-piket-btn'),
        userModal: document.getElementById('user-modal'), userModalTitle: document.getElementById('user-modal-title'), userForm: document.getElementById('user-form'), cancelUserBtn: document.getElementById('cancel-user-btn'),
        dateModal: document.getElementById('date-modal'), dateModalTitle: document.getElementById('date-modal-title'), dateForm: document.getElementById('date-form'), cancelDateBtn: document.getElementById('cancel-date-btn'),
        notesModal: document.getElementById('notes-modal'), notesModalTitle: document.getElementById('notes-modal-title'), notesForm: document.getElementById('notes-form'), cancelNotesBtn: document.getElementById('cancel-notes-btn'),
        passwordModal: document.getElementById('password-modal'), passwordForm: document.getElementById('password-form'), cancelPasswordBtn: document.getElementById('cancel-password-btn'),
        tabSchedule: document.getElementById('tab-schedule'), tabTasks: document.getElementById('tab-tasks'), tabPiket: document.getElementById('tab-piket'), tabUsers: document.getElementById('tab-users'), tabDates: document.getElementById('tab-dates'), tabSettings: document.getElementById('tab-settings'),
        scheduleContainer: document.getElementById('schedule-container'), tasksContainer: document.getElementById('tasks-container'), piketContainer: document.getElementById('piket-container'), usersContainer: document.getElementById('users-container'), datesContainer: document.getElementById('dates-container'), settingsContainer: document.getElementById('settings-container'),
        toast: document.getElementById('toast'), toastMessage: document.getElementById('toast-message'),
        clockDisplay: document.getElementById('clock'), notificationBanner: document.getElementById('notification-banner'), notificationMessage: document.getElementById('notification-message'), closeNotificationBtn: document.getElementById('close-notification-btn'),
        notificationIconContainer: document.getElementById('notification-icon-container'), notificationBadge: document.getElementById('notification-badge'),
        registerStep: document.getElementById('register-step'), registerForm: document.getElementById('register-form'), registerError: document.getElementById('register-error'),
        showRegisterLink: document.getElementById('show-register-link'), backToLoginBtn: document.getElementById('back-to-login-btn'),
    };

    // --- Constants & State ---
    const USER_SETTINGS_KEY = 'userSettings';
    const daysOrder = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
    let currentUser = null, session = null, clockInterval, breakCheckInterval;

    // --- Helper Functions ---
    const showToast = (msg) => { allElements.toastMessage.textContent = msg; allElements.toast.classList.add('show'); setTimeout(() => allElements.toast.classList.remove('show'), 3000); };
    const showNotificationBadge = () => { allElements.notificationBadge.classList.remove('hidden'); };
    const hideNotificationBadge = () => { allElements.notificationBadge.classList.add('hidden'); };
    
    // --- SUPABASE DATA FUNCTIONS ---
    const getProfile = async (userId) => { const { data } = await supabaseClient.from('profiles').select('username, role').eq('id', userId).single(); return data; };
    const getSchedules = async () => { const { data } = await supabaseClient.from('schedules').select('*').eq('class_name', session.user.user_metadata.selectedClass); return data || []; };
    const getTasks = async () => { const { data } = await supabaseClient.from('tasks').select('*').eq('class_name', session.user.user_metadata.selectedClass); return data || []; };
    const getPiket = async () => { const { data } = await supabaseClient.from('piket').select('*').eq('class_name', session.user.user_metadata.selectedClass); return data || []; };
    const getImportantDates = async () => { const { data } = await supabaseClient.from('important_dates').select('*'); return data || []; };
    const getNotes = async () => { const { data } = await supabaseClient.from('notes').select('*').eq('user_id', session.user.id).eq('class_name', session.user.user_metadata.selectedClass); return data || []; };
    const getUserSettings = async () => { if (!session) return {}; const { data } = await supabaseClient.from('settings').select('*').eq('user_id', session.user.id).single(); return data || {}; };
    const saveUserSettings = async (settings) => { if (!session) return; await supabaseClient.from('settings').upsert({ user_id: session.user.id, ...settings }); };
    const getUsers = async () => { const { data } = await supabaseClient.from('profiles').select('*'); return data || []; };

    // --- RENDER FUNCTIONS (now async) ---
    const createScheduleCard = (schedule, role) => { /* ... implementation ... */ };
    const renderSchedules = async () => { /* ... implementation ... */ };
    const createTaskCard = (task, role) => { /* ... implementation ... */ };
    const renderTasks = async () => { /* ... implementation ... */ };
    const createPiketCard = (piketData, role) => { /* ... implementation ... */ };
    const renderPiket = async () => { /* ... implementation ... */ };
    const createDateCard = (date, role) => { /* ... implementation ... */ };
    const renderImportantDates = async () => { /* ... implementation ... */ };
    const createUserCard = (user) => { /* ... implementation ... */ };
    const renderUsers = async () => { /* ... implementation ... */ };
    const renderSettings = async () => { /* ... implementation ... */ };

    // --- Application Flow ---
    const applySettings = async () => { /* ... implementation ... */ };
    const showLoginPage = () => { /* ... implementation ... */ };
    const showMainApp = async () => { /* ... implementation ... */ };
    const handleLogout = async () => { /* ... implementation ... */ };

    // --- Event Handlers ---
    const switchTab = (activeTab) => { /* ... implementation ... */ };
    
    // ... all event handlers defined here ...

    // --- Initial Check ---
    const init = async () => {
        await applySettings();
        const classes = "ABCDEFGHIJKL".split('').map(char => `XII-${char}`);
        classes.forEach(c => { const option = document.createElement('option'); option.value = c; option.textContent = c; allElements.classSelect.appendChild(option); });
        const { data } = await supabaseClient.auth.getSession();
        session = data.session;
        if (session) { await showMainApp(); } else { showLoginPage(); }
    };
    init();
});
</script>
</body>
</html>

